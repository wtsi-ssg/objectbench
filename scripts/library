# Ensure we are using rvm

function two_phase_test {
echo "Tagging tests as ${OBJECTBENCH_TAG}"
cd $OBJECT_BENCH_HOME
bundle exec rake add_initial_writes
bundle exec rake wait_for_stable
echo "Loading tests"
bundle exec rake load_tests
echo "Test Tagged as ${OBJECTBENCH_TAG}"
bundle exec rake wait_for_stable
echo "Checking once more"
sleep 20 
bundle exec rake wait_for_stable
echo "Test Tagged as ${OBJECTBENCH_TAG}"
}

function setup_two_read_write_test {
# OBJECTBENCH_INITAL_FILES is the list of files used for writes to the object
# store in the first first phase of the tests. These files are read as part
# of the second phase. Alternatively this phase can be used to fill the 
# object store up to a specific amount before  running any tests.
#
# OBJECTBENCH_INITAL_DISTRIBUTION this is used to specify how many of each of
# the files in OBJECTBENCH_INITAL_FILES is placed in to the object store for
# example "1,2,3,4,5,6,7" would store one of the first file, two of the 
# second etc.
export OBJECTBENCH_INITAL_DISTRIBUTION="86, 103, 68, 113, 588, 405, 140, 29, 137, 117, 3"
export OBJECTBENCH_INITAL_FILES="/warehouse/isg_wh_scratch01/users/jb23/object_test/zero_length  /warehouse/isg_wh_scratch01/users/jb23/object_test/11166_2#168.bai  /warehouse/isg_wh_scratch01/users/jb23/object_test/11128_8#0_phix.flagstat  /warehouse/isg_wh_scratch01/users/jb23/object_test/11330_1#19.bamcheck  /warehouse/isg_wh_scratch01/users/jb23/object_test/11304_1#86_phix_quality_error.txt  /warehouse/isg_wh_scratch01/users/jb23/object_test/11310_2#56_phix_quality_cycle_surv.txt  /warehouse/isg_wh_scratch01/users/jb23/object_test/6320_5.bai  /warehouse/isg_wh_scratch01/users/jb23/object_test/6244_1#9.bam  /warehouse/isg_wh_scratch01/users/jb23/object_test/6350_4#1.bam  /warehouse/isg_wh_scratch01/users/jb23/object_test/11149_5#12.cram  /warehouse/isg_wh_scratch01/users/jb23/object_test/7231_1#146.bam"
# This is the approximate distribution of file sizes in the main test
export OBJECTBENCH_TEST_WRITE_DISTRIBUTION="$OBJECTBENCH_INITAL_DISTRIBUTION"
# This is the distribution of Write,reads and partial reads
export OBJECTBENCH_TEST_WORKLOAD_DISTRIBUTION="600,300,100"
# This is the default tag of the run hopefully with the name of the subject 
# included.
export OBJECTBENCH_TAG="Test_run_${OBJECTBENCH_SYSTEM_UNDER_TEST}_$$"
 }
